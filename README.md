# planner.py
## Поширені проблеми та їх вирішення

### 1. Недостатній початковий імпульс (Throttle)

* **Проблема:** Навіть при, здавалося б, високих значеннях throttle (наприклад, 1750-1850), віртуальна модель дрона в SITL може не генерувати достатньої підйомної сили для подолання гравітації та інерції, або для належного "захоплення" висоти в режимі `ALT_HOLD`. Дрон може ненадовго піднятися на метр-два, а потім опуститися.

* **Вирішення:**
    * **Збільште `ALT_HOLD_THROTTLE_ASCENT`:** Спробуйте значно вищі значення, наприклад, **1900-1950**. Це "змусить" дрон підійматися агресивніше.
    * **Збільште `ASCENT_DURATION_SEC`:** Збільшіть час, протягом якого дрон перебуває в цій фазі сильного підйому. Спробуйте **7-10 секунд** або більше. Це дасть дрону достатньо часу, щоб набрати потрібну висоту та стабілізуватися, перш ніж переходити до режиму зависання.

### 2. Проблеми з PID-регулятором висоти в прошивці

* **Проблема:** У режимі `ALT_HOLD` здатність дрона підтримувати висоту контролюється його PID-регулятором (пропорційно-інтегрально-диференціальним). Якщо ці параметри (особливо **`PSC_ACCZ_P`** та **`PSC_ACCZ_I`**) не оптимізовані для конкретної симульованої моделі, дрон може погано утримувати висоту, коли throttle повертається до нейтральної точки (1500).

* **Вирішення:**
    * **Скидання параметрів до типових:** Це часто найпростіше та найефективніше рішення.
        1.  Підключіться до вашого екземпляра SITL за допомогою **Mission Planner** або **QGroundControl**.
        2.  Перейдіть до "Full Parameter List" (Mission Planner) або "Parameters" -> "Full Parameter Tree" (QGroundControl).
        3.  Знайдіть опцію "Load default parameters" або "Reset all parameters to default".
        4.  Після скидання **перезапустіть ваш екземпляр SITL** (закрийте та знову запустіть `sim_vehicle.py`).
    * **Перевірте `PSC_ACCZ_P` та `PSC_ACCZ_I`:** Переконайтеся, що ці значення не є аномально низькими після скидання. Для квадрокоптерів типові діапазони становлять приблизно **0.3-0.6 для `P` та 0.6-1.2 для `I`**. Якщо ви вирішите налаштувати їх вручну, робіть це невеликими кроками.

### 3. Нестабільна або некоректна модель рами в SITL

* **Проблема:** Деякі стандартні моделі рами в SITL можуть бути менш стабільними або погано налаштованими за замовчуванням, що призводить до нестабільної поведінки в польоті або труднощів з утриманням висоти. Фізичні характеристики дрона (наприклад, кількість двигунів, розподіл ваги) симулюються SITL.

* **Вирішення:**
    * **Спробуйте інший тип рами:** При запуску SITL за допомогою `sim_vehicle.py` вкажіть інший, часто більш стабільний, тип рами. Це також автоматично завантажить типові параметри, оптимізовані для цієї рами.
        * **Рекомендовано:** Почніть з **гексакоптера (`--frame=hexa`)**, оскільки він, як правило, забезпечує кращу стабільність і підйомну силу.
            ```bash
            python3 sim_vehicle.py --frame=hexa --map --console
            ```
        * **Альтернатива:** **Октокоптер (`--frame=octa`)** забезпечує ще більшу потужність та стабільність.
            ```bash
            python3 sim_vehicle.py --frame=octa --map --console
            ```
        * Якщо ви хочете залишитися з квадрокоптером, можете спробувати `--frame=X` або `--frame=plus`, які є різними конфігураціями розташування двигунів.

### 4. "Unhealthy AHRS" або проблеми з датчиками

* **Проблема:** Повідомлення "unhealthy AHRS" (Attitude and Heading Reference System — система визначення положення та курсу) вказує на те, що внутрішня навігаційна система дрона не може надійно визначити його орієнтацію. Це критично, і дрон відмовиться злітати або залишатиметься нестабільним, якщо AHRS несправна. Зазвичай це виникає через проблеми з симульованими даними IMU (акселерометр/гіроскоп) або компаса.

* **Вирішення:**
    * **Повний перезапуск SITL:** Завжди починайте з чистого аркуша. Закрийте всі вікна SITL та знову запустіть `sim_vehicle.py`.
    * **Скиньте всі параметри до типових (знову):** Як описано в пункті 2. Пошкоджені параметри є поширеною причиною.
    * **Оновіть ArduPilot та залежності:** Переконайтеся, що вихідний код ArduPilot та бібліотеки Python (`dronekit`, `pymavlink`) актуальні.
        ```bash
        # Оновити вихідний код ArduPilot
        cd /шлях/до/вашого/ardupilot
        git pull
        git submodule update --init --recursive
        ./waf configure --board=sitl
        ./waf build --target bin/arducopter

        # Оновити бібліотеки Python
        pip install --upgrade dronekit pymavlink
        ```
    * **Моніторинг консолі SITL:** Уважно стежте за виведенням у вікні `sim_vehicle.py --console` під час запуску SITL та польоту. Шукайте будь-які повідомлення про помилки, пов'язані з IMU, гіроскопом, компасом або GPS. Ці повідомлення є ключовими для діагностики основної причини несправного AHRS.


# drone.py
Оскільки режим ALT_HOLD не підтримує GPS-навігацію та в SITL не працює стабільно через відсутність емуляції барометра, завдання потрібно реалізовувати в режимі GUIDED. Це дозволить виконати автоматичний взліт, політ за GPS до заданої точки й обертання коптера на потрібний азимут. Нижче — повний приклад коду для запуску в SITL через порт 127.0.0.1:5762

#Test 2
Щоб знайти координати центру зображення в географічних координатах (широта, довгота), маючи:
Азимут руху дрона: 335° (тобто вгору по зображенню),
Координати контрольної точки: (50.603694, 30.650625),
Контрольна точка на зображенні знаходиться у піксельних координатах (558, 328),
Центр зображення у піксельних координатах: (320, 256),
1 піксель = 0.38 метра на місцевості.
Ми можемо обчислити географічні координати центру зображення наступним чином:
https://colab.research.google.com/drive/1KDkxfawnGHeozWhJxBYQXkxXCXatL3ld?usp=sharing
